/*! For license information please see 9224.20a2e164264763256f2b.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_guidebooks_playground=self.webpackChunk_guidebooks_playground||[]).push([[9224],{96690:(e,n,i)=>{i.d(n,{kQ:()=>d,hV:()=>l});var o=i(11227),t=i.n(o),s=i(17187),r=(i(29224),function(e,n,i,o){return new(i||(i=Promise))((function(t,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function c(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}d((o=o.apply(e,n||[])).next())}))});const c=t()("plugins/bash-like/pty/channel");var d;!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(d||(d={}));class l extends s.EventEmitter{constructor(){super(...arguments),this.readyState=d.OPEN}init(){return r(this,void 0,void 0,(function*(){c("IPC init");const{body:e}=yield window["webview-proxy"]({command:"init",provider:"pty",channel:this});this.channelId=e.channelId,console.log(`CHANNELID ${this.channelId}`),this.emit("open"),c("IPC init done")}))}close(){this.emit("exit")}send(e){console.log(`SEND ${this.channelId}`),window["webview-proxy"]({command:"send",provider:"pty",channelId:this.channelId,body:e})}removeEventListener(e,n){this.off(e,n)}}},29224:(e,n,i)=>{i.r(n),i.d(n,{disableBashSessions:()=>E,getLoginShell:()=>N,getShellOpts:()=>C,setShellAliases:()=>P,onConnection:()=>L,main:()=>$,default:()=>D});var o=i(11227),t=i.n(o),s=i(10561),r=i(89539),c=i(26470),d=i(67953),l=i(67435),u=i(79267),a=i(76489),h=i(3103),f=i(48764).Buffer,v=i(186),p=function(e,n,i,o){return new(i||(i=Promise))((function(t,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function c(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}d((o=o.apply(e,n||[])).next())}))};const y=t()("plugins/bash-like/pty/server");let w=8083;const m=[],g=function(e){const n=(0,l.homedir)();return e?"~"===e?n:"~/"!==e.slice(0,2)&&"~\\"!==e.slice(0,2)?e:(0,c.join)(n,e.slice(2)):e},b=e=>({req:n},i)=>{const o=(0,a.Q)(n.headers.cookie||""),t=o[e.key];if(t)try{const n=JSON.parse(f.from(t,"base64").toString("utf-8"));if(n.token===e.session.token)return void i(!0);console.error("token found, but mismatched values",e,n)}catch(e){console.error("error parsing session token",t,e)}console.error("invalid session for websocket upgrade",e,o[e.key],o),i(!1,401,"Invalid authorization for websocket upgrade")};let S;const k=()=>(0,c.join)(v.env.HOME,".bash_sessions_disable"),x=()=>p(void 0,void 0,void 0,(function*(){yield(0,r.promisify)(s.unlink)(k())})),E=()=>p(void 0,void 0,void 0,(function*(){return"darwin"!==v.platform||(void 0===S&&(S=yield(0,r.promisify)(s.exists)(k())),S)?()=>p(void 0,void 0,void 0,(function*(){})):(yield(e=>{const n=(0,r.promisify)(s.open),i=(0,r.promisify)(s.close);return n(e,"w").then(i)})(k()),x)}));let O;const N=()=>new Promise(((e,n)=>{if(O)y("returning cached login shell",O),e(O);else if(v.env.SHELL)e(v.env.SHELL);else{const i="win32"===v.platform?"powershell.exe":"/bin/bash";if(void 0!==v.env.TRAVIS_JOB_ID||"win32"===v.platform)y("using defaultShell for travis"),O=i,e(O);else try{(0,d.exec)(`${i} -l -c "echo $SHELL"`,((o,t,s)=>p(void 0,void 0,void 0,(function*(){o?(console.error("error in getLoginShell subroutine",o),s&&console.error(s),n(o)):(O=t.trim()||i,y("login shell",O),e(O))}))))}catch(n){console.error("error in exec of getLoginShell subroutine",n),e(i)}}}));function C(){return p(this,void 0,void 0,(function*(){const e=(yield i.e(6189).then(i.bind(i,76189))).default,n="win32"===v.platform?void 0:["--rcfile",yield e,"-i","-c","--"],o=yield i.e(1668).then(i.t.bind(i,17186,19)).catch((()=>{})),t=o&&o.shellExe||"",s=o&&o.shellOpts||[];return{shellExe:t||("win32"===v.platform?"powershell.exe":"/bin/bash"),shellOpts:s&&Array.isArray(s)&&s.length>0?s:"win32"===v.platform?[]:n}}))}let I={};function P(e){I=e}const L=(e,n,o)=>t=>p(void 0,void 0,void 0,(function*(){y("onConnection",n,o,t);const{spawn:s}=yield Promise.resolve().then(i.t.bind(i,24575,23)),r={},c={};t.on("message",(d=>p(void 0,void 0,void 0,(function*(){try{const l=JSON.parse(d);switch(l.type){case"xon":{const e=l.uuid&&(yield r[l.uuid]);if(e){const n="";e.write(n)}const n=l.uuid&&c[l.uuid];n&&n.xon();break}case"xoff":{const e=l.uuid&&(yield r[l.uuid]);if(e){const n="";e.write(n)}const n=l.uuid&&c[l.uuid];n&&n.xoff();break}case"kill":{const e=l.uuid&&(yield r[l.uuid]);e&&(e.kill(l.signal||"SIGHUP"),r[l.uuid]=void 0);const n=l.uuid&&c[l.uuid];y(`kill requested. hasShell=${void 0!==e} hasJob=${void 0!==n}`),n&&(n.abort(),c[l.uuid]=void 0);break}case"exit":for(const e in r)r[e]&&((yield r[e]).kill("SIGHUP"),r[e]=void 0);for(const e in c)c[e]&&(c[e].abort(),c[e]=void 0);return e(l.exitCode||0);case"request":{const{internalBeCarefulExec:e}=yield Promise.resolve().then(i.bind(i,18495));l.env&&(v.env=l.env);const n=e=>{t.send(e)},o=Object.assign({},l.execOptions,{rethrowErrors:!0});l.stream&&(y("initializing streaming exec",l.uuid),o.onInit=e=>(c[l.uuid]=e,e=>t.send(JSON.stringify({type:"chunk",uuid:l.uuid,chunk:e}))));try{const i=yield e(l.cmdline,o);y("got response"),n(JSON.stringify({type:"object",uuid:l.uuid,response:i}))}catch(e){y("got error",e.message);const i=e;n(JSON.stringify({type:"object",uuid:l.uuid,response:{code:i.code||i.statusCode,statusCode:i.statusCode,message:i.message,stack:i.stack}}))}break}case"exec":r[l.uuid]=new Promise(((i,c)=>p(void 0,void 0,void 0,(function*(){try{const c=Object.assign({},v.env,l.env,{KUI:"true"});!v.env.DEBUG||l.env&&l.env.DEBUG||delete c.DEBUG,c.HOME&&(c.HOME=g(c.HOME));const d=l.cmdline.indexOf(" "),u=l.cmdline.slice(0,d<0?l.cmdline.length:d),a=I[u],h=a?l.cmdline.replace(new RegExp(`^${u}`),a):l.cmdline,{shellExe:f,shellOpts:p}=yield C();let y=s(f,p.concat([h]),{uid:n,gid:o,name:"xterm-color",rows:l.rows,cols:l.cols,cwd:g(l.cwd)||v.cwd(),env:c});y.on("data",(e=>{t.send(JSON.stringify({type:"data",data:e,uuid:l.uuid}))})),y.on("exit",(n=>{y=void 0,l.uuid&&delete r[l.uuid],t.send(JSON.stringify({type:"exit",exitCode:n,uuid:l.uuid})),e(n)})),t.send(JSON.stringify({type:"state",state:"ready",uuid:l.uuid})),i(y)}catch(e){console.error("could not exec",e),c(e)}}))));break;case"data":try{const e=l.uuid&&(yield r[l.uuid]);if(e)return e.write(l.data);console.error("could not write to the shell, as we had no uuid, or no matching shell instance",l.uuid,l.data)}catch(e){console.error("could not write to the shell",e)}break;case"resize":try{const e=l.uuid&&(yield r[l.uuid]);if(e)return e.resize(l.cols,l.rows);console.error("could not resize pty, as we had no uuid, or no matching shell instance",l.uuid)}catch(e){console.error(`error in resize ${l.cols} ${l.rows}`),console.error("could not resize pty",e)}}}catch(e){console.error(e)}}))))}));let U,H;const $=(e,n,o,t)=>p(void 0,void 0,void 0,(function*(){if(U)return H;{const r=(yield Promise.resolve().then(i.t.bind(i,18083,23))).default;return new Promise((c=>p(void 0,void 0,void 0,(function*(){const d=m.length,l=yield E(),a=e=>p(void 0,void 0,void 0,(function*(){yield l(e);const{wss:n,server:i}=m.splice(d,1)[0];n.close(),i&&i.close()}));if(o){const i=new r.Server({noServer:!0,verifyClient:t&&b(t)});m.push({wss:i});const o=(t,s,r)=>{const c=t.url.match(/\/bash\/([0-9a-z-]+)/);(c&&c[1])===e&&(n.removeListener("upgrade",o),i.handleUpgrade(t,s,r,(function(e){i.emit("connection",e,t)})))};n.on("upgrade",o),c({wss:i,port:H,exitNow:a})}else{H=yield new Promise(((e,n)=>p(void 0,void 0,void 0,(function*(){const{createServer:o}=(yield Promise.resolve().then(i.t.bind(i,85863,23))).default,t=()=>{const i=w;w+=1;const s=o();s.listen(i,(()=>{s.once("close",(function(){e(i)})),s.close()})),s.on("error",(e=>{"EADDRINUSE"===e.code?t():n(e)}))};t()}))));const e=(0,u.createServer)({key:s.readFileSync(".keys/key.pem","utf8"),cert:s.readFileSync(".keys/cert.pem","utf8"),passphrase:v.env.PASSPHRASE,requestCert:!1,rejectUnauthorized:!1});e.listen(H,(()=>p(void 0,void 0,void 0,(function*(){const n=U=new r.Server({server:e});m.push({wss:U,server:e}),c({wss:n,port:H,exitNow:a})}))))}})))).then((({wss:e,port:n,exitNow:i})=>(t||(y("listening for connection"),e.on("connection",L(i,t&&t.session.uid,t&&t.session.gid))),{wss:e,port:n})))}})),D=e=>{e.listen("/bash/websocket/stdio",(()=>new Promise(((e,n)=>p(void 0,void 0,void 0,(function*(){try{yield(new h.h).init((e=>{y("done with stdiochannel"),v.exit(e)}))}catch(e){n(e)}}))))),{requiresLocal:!0}),e.listen("/bash/websocket/open",(()=>{throw new Error("Unsupported operation")}),{requiresLocal:!0})}},3103:(e,n,i)=>{i.d(n,{h:()=>f});var o=i(11227),t=i.n(o),s=i(17187),r=i(29224),c=i(96690),d=i(186),l=function(e,n,i,o){return new(i||(i=Promise))((function(t,s){function r(e){try{d(o.next(e))}catch(e){s(e)}}function c(e){try{d(o.throw(e))}catch(e){s(e)}}function d(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(r,c)}d((o=o.apply(e,n||[])).next())}))};t()("plugins/bash-like/pty/stdio-channel-proxy-stderr");const u=t()("plugins/bash-like/pty/stdio-channel-proxy"),a=t()("plugins/bash-like/pty/stdio-channel-kui"),h="\n";class f extends s.EventEmitter{constructor(){super(...arguments),this.readyState=c.kQ.OPEN}init(e){return l(this,void 0,void 0,(function*(){a("StdioChannelKuiSide.init"),yield(0,r.onConnection)((()=>{}))(this);let e="";d.stdin.on("data",(n=>{const i=n.lastIndexOf(h);if(i<0)return void(e+=n);const o=e+n.slice(0,i).toString();e=i<0?"":n.slice(i).toString(),o.split(h).filter((e=>e)).forEach((e=>{a("input",e),this.emit("message",e)}))})),this.send("open")}))}close(){u("closing stdio channel"),this.emit("close")}send(e){if(this.readyState===c.kQ.OPEN)try{d.stdout.write(`${e}\n`)}catch(e){console.error("error in process write",e)}}removeEventListener(e,n){this.off(e,n)}}},76489:(e,n)=>{n.Q=function(e,n){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var o={},s=n||{},c=e.split(t),d=s.decode||i,l=0;l<c.length;l++){var u=c[l],a=u.indexOf("=");if(!(a<0)){var h=u.substr(0,a).trim(),f=u.substr(++a,u.length).trim();'"'==f[0]&&(f=f.slice(1,-1)),null==o[h]&&(o[h]=r(f,d))}}return o};var i=decodeURIComponent,o=encodeURIComponent,t=/; */,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function r(e,n){try{return n(e)}catch(n){return e}}}}]);