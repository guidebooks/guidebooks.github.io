"use strict";(self.webpackChunk_guidebooks_playground=self.webpackChunk_guidebooks_playground||[]).push([[3129],{3129:(n,e,i)=>{i.r(e),i.d(e,{getChannelForTab:()=>d,init:()=>b,invalidateSession:()=>v,pollUntilOnline:()=>f});var t=i(11227),o=i.n(t),s=i(91119);const r=o()("plugins/bash-like/pty/ui");var u=i(84932),a=function(n,e,i,t){return new(i||(i=Promise))((function(o,s){function r(n){try{a(t.next(n))}catch(n){s(n)}}function u(n){try{a(t.throw(n))}catch(n){s(n)}}function a(n){var e;n.done?o(n.value):(e=n.value,e instanceof i?e:new i((function(n){n(e)}))).then(r,u)}a((t=t.apply(n,e||[])).next())}))};const l=(0,s.i18n)("plugin-bash-like"),c=o()("plugins/bash-like/pty/session");function d(n){if((0,u.Lu)())throw new Error("Exiting");if(s.Capabilities.inBrowser())return(0,u.E6)(n)}function f(n){return new Promise((e=>{let i=!1;const t=setTimeout((()=>{i||(r("setOffline"),s.Events.eventChannelUnsafe.emit("/proxy/offline"))}),5e3),o=(a=0)=>(c("trying to establish session",n),n.REPL.qexec("echo initializing session",void 0,void 0,{tab:n}).then((()=>{i=!0,clearTimeout(t),r("setOnline"),s.Events.eventChannelUnsafe.emit("/proxy/online"),e()})).catch((e=>{const i=e;return 503!==i.code&&(console.error("error establishing session",i.code,i.statusCode,i),(0,u.e5)(n)),setTimeout((()=>o(a+1)),a<10?2e3:a<100?4e3:1e4),l("Could not establish a new session")})));o()}))}function h(n){return a(this,void 0,void 0,(function*(){const e=(0,u.E6)(n)||new Promise(((e,i)=>a(this,void 0,void 0,(function*(){try{yield f(n),n.classList.add("kui--session-init-done"),e(yield d(n))}catch(n){i(n)}}))));yield e,n.classList.add("kui--session-init-done")}))}function v(n){(0,u.e5)(n),s.Events.eventBus.emit("/tab/offline",n),s.Events.eventBus.emitWithTabId("/tab/offline",n.state.uuid)}function b(n){return a(this,void 0,void 0,(function*(){const{proxyServer:e}=yield i.e(98950).then(i.t.bind(i,17186,19)).catch((()=>(console.log("using default proxy configuration"),{proxyServer:{enabled:!1}})));s.Capabilities.inBrowser()&&!1!==e.enabled&&(c("initializing pty sessions"),n.registerSessionInitializer(h))}))}},84932:(n,e,i)=>{i.d(e,{Lu:()=>s,e5:()=>r,E6:()=>u,oY:()=>a});let t,o=!1;function s(){return o}function r(n){t=void 0}function u(n){return t}function a(n,e){return t=e,e.then((n=>{window.addEventListener("beforeunload",(()=>{o=!0,n.close()}))})),t}}}]);